{% extends 'base.html' %}

{% block title %}{{ post.title }} · Blog Speaks{% endblock %}
{% block meta_description %}{{ post.subtitle }}{% endblock %}

{% block hero %}
<section class="hero-section post-hero" style="--hero-image: url('{{ url_for('static', filename='cloud.jpg') }}');">
  <div class="container position-relative">
    <div class="hero-copy" data-animate="fade-up">
      <p class="eyebrow mb-3 text-highlight">Deep Dive</p>
      <h1 class="display-heading">{{ post.title }}</h1>
      <p class="lead text-light opacity-85 mb-4 col-lg-8 px-0">{{ post.subtitle }}</p>
      <div class="d-flex flex-wrap gap-3 align-items-center text-light">
        <span class="badge badge-soft">By {{ post.author or 'Blog Speaks' }}</span>
        <span class="badge badge-soft">{{ post.date_posted.strftime('%B %d, %Y') }}</span>
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block content %}
<div class="container">
  <article class="post-article" data-animate="fade-up">
    <div class="post-info-bar">
      <div>
        <p class="eyebrow mb-2">Author</p>
        <h4 class="mb-0">{{ post.author or 'Blog Speaks' }}</h4>
      </div>
      <div>
        <p class="eyebrow mb-2">Published</p>
        <p class="mb-0 text-muted">{{ post.date_posted.strftime('%B %d, %Y') }}</p>
      </div>
      <div class="share-actions">
        <p class="eyebrow mb-2">Share</p>
        <div class="d-flex gap-2">
          <a class="icon-btn" href="https://twitter.com/intent/tweet?text={{ post.title|urlencode }}&url={{ request.url|urlencode }}" target="_blank" rel="noopener">
            <i class="fa fa-twitter"></i>
          </a>
          <a class="icon-btn" href="https://www.linkedin.com/sharing/share-offsite/?url={{ request.url|urlencode }}" target="_blank" rel="noopener">
            <i class="fa fa-linkedin"></i>
          </a>
          <button class="icon-btn" type="button" data-copy="{{ request.url }}">
            <i class="fa fa-link"></i>
          </button>
        </div>
      </div>
    </div>
    <div class="post-body">
      {{ post.content|safe }}
    </div>
  </article>

  <div class="callout-panel mt-5" data-animate="fade-up">
    <div>
      <p class="eyebrow mb-2">Inspired?</p>
      <h3 class="h2 mb-3">Document your own experiment and pay it forward.</h3>
      <p class="text-muted mb-0">Turn your lessons into leverage for the community. We’ll feature standout stories in the weekly digest.</p>
    </div>
    <a class="btn btn-hero" href="{{ url_for('add') }}">Publish next</a>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  document.querySelectorAll('[data-copy]').forEach(function (btn) {
    btn.addEventListener('click', function () {
      var link = this.getAttribute('data-copy');

      function showConfirmation(context) {
        context.classList.add('copied');
        context.innerHTML = '<i class="fa fa-check"></i>';
        setTimeout(function () {
          context.classList.remove('copied');
          context.innerHTML = '<i class="fa fa-link"></i>';
        }, 1600);
      }

      if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(link).then(() => showConfirmation(btn));
      } else {
        var tempInput = document.createElement('textarea');
        tempInput.value = link;
        tempInput.setAttribute('readonly', '');
        tempInput.style.position = 'absolute';
        tempInput.style.left = '-9999px';
        document.body.appendChild(tempInput);
        tempInput.select();
        try {
          document.execCommand('copy');
          showConfirmation(btn);
        } catch (err) {
          console.warn('Copy failed', err);
        }
        document.body.removeChild(tempInput);
      }
    });
  });
</script>
{% endblock %}
